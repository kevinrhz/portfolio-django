{% extends 'base.html' %}
{% load static %}

{% block title %}Projects{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/projects.css' %}">
<link rel="stylesheet" href="{% static 'css/filter_buttons.css' %}"> {# Shared CSS for filter buttons #}
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/filterSystem.js' %}" defer></script>
<script src="{% static 'js/projects_page_filter_init.js' %}" defer></script> {# Specific init for this page's filters #}
<script src="{% static 'js/projects_card_expansion.js' %}" defer></script> {# Your card expansion logic #}
{% endblock %}

{% block content %}
<main class="projects-page">
    <header class="projects-header section-header">
        <h1>My Projects</h1>
        <p class="subtitle">Filter by category or view all my work.</p>
        <div class="view-selector project-filters">
            <button class="view-toggle-btn" data-filter="all">All Projects</button>
            {% if project_categories %}
                {% for category in project_categories %}
                <button class="view-toggle-btn" data-filter="{{ category.slug }}">{{ category.name }}</button>
                {% endfor %}
            {% endif %}
            {# You can add more static buttons here if needed, e.g., for "Research" if not in categories model #}
        </div>
    </header>

    <section class="projects-grid filterable-content">
        {% for project in projects %}
        <div class="project-card filter-item" data-project-id="{{ project.title|slugify }}" data-category="{{ project.get_category_slugs_for_data_attr }}">
            {% if project.poster_image_path %}
            <img src="{% static project.poster_image_path %}" alt="{{ project.title }} Poster" class="project-image">
            {% else %}
            {# Fallback if no poster image specified in admin #}
            <img src="{% static 'images/placeholder_project.webp' %}" alt="{{ project.title }} Placeholder" class="project-image">
            {% endif %}
            <div class="project-details">
                <p class="short-description">{{ project.short_description }}</p>
                <div class="project-links">
                    {% if project.github_url %}<a target="_blank" rel="noopener noreferrer" href="{{ project.github_url }}" class="btn">GitHub</a>{% endif %}
                    {% if project.live_url %}<a target="_blank" rel="noopener noreferrer" href="{{ project.live_url }}" class="btn">Live Site</a>{% endif %}
                    {% if project.demo_url_name %}<a href="{% url project.demo_url_name %}" class="btn">Demo</a>{% endif %}
                    <a href="#" class="btn btn-details">Details</a> {# This button triggers JS expansion #}
                </div>
            </div>
            <div class="project-expanded-content">
                 <h2>{{ project.title }}</h2>
                 {# You can add a subtitle field to your Project model if needed, e.g., project.subtitle #}
                 {# For now, let's assume the main long_description covers this #}
                 {% if project.long_description %}
                 <p class="long-description">{{ project.long_description|linebreaksbr }}</p>
                 {% endif %}
                 {% if project.get_tech_stack_as_list %}
                 <ul class="tech-stack">
                    {% for tech in project.get_tech_stack_as_list %}
                    <li>{{ tech }}</li>
                    {% endfor %}
                 </ul>
                 {% endif %}
                 {# Add more links or content for expanded view if desired #}
            </div>
        </div>
        {% empty %}
        <p class="no-content-notice">No projects to display yet. Check back soon!</p>
        {% endfor %}
        {# You could also loop through 'featured_projects' separately if you want them in a different section #}
    </section>
</main>
{% endblock %}